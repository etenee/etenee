'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _utils = require('./utils');

var _utils2 = _interopRequireDefault(_utils);

var _defaultProps = require('./defaultProps');

var _defaultProps2 = _interopRequireDefault(_defaultProps);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = {
  getDefaultProps: function getDefaultProps() {
    return _defaultProps2.default;
  },
  getInitialState: function getInitialState() {
    return {
      page: 0,
      pageSize: this.props.defaultPageSize || 10,
      sorting: this.props.defaultSorting,
      expandedRows: {}
    };
  },
  getResolvedState: function getResolvedState(props, state) {
    var resolvedState = _extends({}, _utils2.default.compactObject(this.state), _utils2.default.compactObject(state), _utils2.default.compactObject(this.props), _utils2.default.compactObject(props));
    return resolvedState;
  },
  componentWillMount: function componentWillMount() {
    this.setStateWithData(this.getDataModel());
  },
  componentDidMount: function componentDidMount() {
    this.fireOnChange();
  },
  componentWillReceiveProps: function componentWillReceiveProps(nextProps, nextState) {
    var oldState = this.getResolvedState();
    var newState = this.getResolvedState(nextProps, nextState);

    // Props that trigger a data update
    if (oldState.data !== newState.data || oldState.columns !== newState.columns || oldState.pivotBy !== newState.pivotBy || oldState.sorting !== newState.sorting) {
      this.setStateWithData(this.getDataModel(nextProps, nextState));
    }
  },
  setStateWithData: function setStateWithData(newState, cb) {
    var oldState = this.getResolvedState();
    var newResolvedState = this.getResolvedState({}, newState);
    var freezeWhenExpanded = newResolvedState.freezeWhenExpanded;

    // Default to unfrozen state

    newResolvedState.frozen = false;

    // If freezeWhenExpanded is set, check for frozen conditions
    if (freezeWhenExpanded) {
      // if any rows are expanded, freeze the existing data and sorting
      var keys = Object.keys(newResolvedState.expandedRows);
      for (var i = 0; i < keys.length; i++) {
        if (newResolvedState.expandedRows[keys[i]]) {
          newResolvedState.frozen = true;
          break;
        }
      }
    }

    // If the data isn't frozen and either the data or
    // sorting model has changed, update the data
    if (oldState.frozen && !newResolvedState.frozen || oldState.sorting !== newResolvedState.sorting || !newResolvedState.frozen && oldState.resolvedData !== newResolvedState.resolvedData) {
      // Handle collapseOnSortingChange & collapseOnPageChange
      if (oldState.sorting !== newResolvedState.sorting && this.props.collapseOnSortingChange || !newResolvedState.frozen && oldState.resolvedData !== newResolvedState.resolvedData && this.props.collapseOnPageChange) {
        newResolvedState.expandedRows = {};
      }

      Object.assign(newResolvedState, this.getSortedData(newResolvedState));
    }

    // Calculate pageSize all the time
    if (newResolvedState.resolvedData) {
      newResolvedState.pages = newResolvedState.manual ? newResolvedState.pages : Math.ceil(newResolvedState.resolvedData.length / newResolvedState.pageSize);
    }

    return this.setState(newResolvedState, cb);
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9saWZlY3ljbGUuanMiXSwibmFtZXMiOlsiZ2V0RGVmYXVsdFByb3BzIiwiZ2V0SW5pdGlhbFN0YXRlIiwicGFnZSIsInBhZ2VTaXplIiwicHJvcHMiLCJkZWZhdWx0UGFnZVNpemUiLCJzb3J0aW5nIiwiZGVmYXVsdFNvcnRpbmciLCJleHBhbmRlZFJvd3MiLCJnZXRSZXNvbHZlZFN0YXRlIiwic3RhdGUiLCJyZXNvbHZlZFN0YXRlIiwiY29tcGFjdE9iamVjdCIsImNvbXBvbmVudFdpbGxNb3VudCIsInNldFN0YXRlV2l0aERhdGEiLCJnZXREYXRhTW9kZWwiLCJjb21wb25lbnREaWRNb3VudCIsImZpcmVPbkNoYW5nZSIsImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLCJuZXh0UHJvcHMiLCJuZXh0U3RhdGUiLCJvbGRTdGF0ZSIsIm5ld1N0YXRlIiwiZGF0YSIsImNvbHVtbnMiLCJwaXZvdEJ5IiwiY2IiLCJuZXdSZXNvbHZlZFN0YXRlIiwiZnJlZXplV2hlbkV4cGFuZGVkIiwiZnJvemVuIiwia2V5cyIsIk9iamVjdCIsImkiLCJsZW5ndGgiLCJyZXNvbHZlZERhdGEiLCJjb2xsYXBzZU9uU29ydGluZ0NoYW5nZSIsImNvbGxhcHNlT25QYWdlQ2hhbmdlIiwiYXNzaWduIiwiZ2V0U29ydGVkRGF0YSIsInBhZ2VzIiwibWFudWFsIiwiTWF0aCIsImNlaWwiLCJzZXRTdGF0ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7Ozs7a0JBRWU7QUFDYkEsaUJBRGEsNkJBQ007QUFDakI7QUFDRCxHQUhZO0FBS2JDLGlCQUxhLDZCQUtNO0FBQ2pCLFdBQU87QUFDTEMsWUFBTSxDQUREO0FBRUxDLGdCQUFVLEtBQUtDLEtBQUwsQ0FBV0MsZUFBWCxJQUE4QixFQUZuQztBQUdMQyxlQUFTLEtBQUtGLEtBQUwsQ0FBV0csY0FIZjtBQUlMQyxvQkFBYztBQUpULEtBQVA7QUFNRCxHQVpZO0FBY2JDLGtCQWRhLDRCQWNLTCxLQWRM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LEtBQUtDLElBQUwsQ0FBVWYsaUJBQWlCTyxZQUFqQixDQUE4QkQsTUFBOUIsR0FBdUNOLGlCQUFpQnhCLFFBQWxFLENBQTVFO0FBQ0Q7O0FBRUQsV0FBTyxLQUFLd0MsUUFBTCxDQUFjaEIsZ0JBQWQsRUFBZ0NELEVBQWhDLENBQVA7QUFDRDtBQTNGWSxDIiwiZmlsZSI6ImxpZmVjeWNsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJy4vdXRpbHMnXG5pbXBvcnQgZGVmYXVsdFByb3BzIGZyb20gJy4vZGVmYXVsdFByb3BzJ1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGdldERlZmF1bHRQcm9wcyAoKSB7XG4gICAgcmV0dXJuIGRlZmF1bHRQcm9wc1xuICB9LFxuXG4gIGdldEluaXRpYWxTdGF0ZSAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhZ2U6IDAsXG4gICAgICBwYWdlU2l6ZTogdGhpcy5wcm9wcy5kZWZhdWx0UGFnZVNpemUgfHwgMTAsXG4gICAgICBzb3J0aW5nOiB0aGlzLnByb3BzLmRlZmF1bHRTb3J0aW5nLFxuICAgICAgZXhwYW5kZWRSb3dzOiB7fVxuICAgIH1cbiAgfSxcblxuICBnZXRSZXNvbHZlZFN0YXRlIChwcm9wcywgc3RhdGUpIHtcbiAgICBjb25zdCByZXNvbHZlZFN0YXRlID0ge1xuICAgICAgLi4uXy5jb21wYWN0T2JqZWN0KHRoaXMuc3RhdGUpLFxuICAgICAgLi4uXy5jb21wYWN0T2JqZWN0KHN0YXRlKSxcbiAgICAgIC4uLl8uY29tcGFjdE9iamVjdCh0aGlzLnByb3BzKSxcbiAgICAgIC4uLl8uY29tcGFjdE9iamVjdChwcm9wcylcbiAgICB9XG4gICAgcmV0dXJuIHJlc29sdmVkU3RhdGVcbiAgfSxcblxuICBjb21wb25lbnRXaWxsTW91bnQgKCkge1xuICAgIHRoaXMuc2V0U3RhdGVXaXRoRGF0YSh0aGlzLmdldERhdGFNb2RlbCgpKVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50ICgpIHtcbiAgICB0aGlzLmZpcmVPbkNoYW5nZSgpXG4gIH0sXG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAobmV4dFByb3BzLCBuZXh0U3RhdGUpIHtcbiAgICBjb25zdCBvbGRTdGF0ZSA9IHRoaXMuZ2V0UmVzb2x2ZWRTdGF0ZSgpXG4gICAgY29uc3QgbmV3U3RhdGUgPSB0aGlzLmdldFJlc29sdmVkU3RhdGUobmV4dFByb3BzLCBuZXh0U3RhdGUpXG5cbiAgICAvLyBQcm9wcyB0aGF0IHRyaWdnZXIgYSBkYXRhIHVwZGF0ZVxuICAgIGlmIChcbiAgICAgIG9sZFN0YXRlLmRhdGEgIT09IG5ld1N0YXRlLmRhdGEgfHxcbiAgICAgIG9sZFN0YXRlLmNvbHVtbnMgIT09IG5ld1N0YXRlLmNvbHVtbnMgfHxcbiAgICAgIG9sZFN0YXRlLnBpdm90QnkgIT09IG5ld1N0YXRlLnBpdm90QnkgfHxcbiAgICAgIG9sZFN0YXRlLnNvcnRpbmcgIT09IG5ld1N0YXRlLnNvcnRpbmdcbiAgICApIHtcbiAgICAgIHRoaXMuc2V0U3RhdGVXaXRoRGF0YSh0aGlzLmdldERhdGFNb2RlbChuZXh0UHJvcHMsIG5leHRTdGF0ZSkpXG4gICAgfVxuICB9LFxuXG4gIHNldFN0YXRlV2l0aERhdGEgKG5ld1N0YXRlLCBjYikge1xuICAgIGNvbnN0IG9sZFN0YXRlID0gdGhpcy5nZXRSZXNvbHZlZFN0YXRlKClcbiAgICBjb25zdCBuZXdSZXNvbHZlZFN0YXRlID0gdGhpcy5nZXRSZXNvbHZlZFN0YXRlKHt9LCBuZXdTdGF0ZSlcbiAgICBjb25zdCB7IGZyZWV6ZVdoZW5FeHBhbmRlZCB9ID0gbmV3UmVzb2x2ZWRTdGF0ZVxuXG4gICAgLy8gRGVmYXVsdCB0byB1bmZyb3plbiBzdGF0ZVxuICAgIG5ld1Jlc29sdmVkU3RhdGUuZnJvemVuID0gZmFsc2VcblxuICAgIC8vIElmIGZyZWV6ZVdoZW5FeHBhbmRlZCBpcyBzZXQsIGNoZWNrIGZvciBmcm96ZW4gY29uZGl0aW9uc1xuICAgIGlmIChmcmVlemVXaGVuRXhwYW5kZWQpIHtcbiAgICAgIC8vIGlmIGFueSByb3dzIGFyZSBleHBhbmRlZCwgZnJlZXplIHRoZSBleGlzdGluZyBkYXRhIGFuZCBzb3J0aW5nXG4gICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMobmV3UmVzb2x2ZWRTdGF0ZS5leHBhbmRlZFJvd3MpXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKG5ld1Jlc29sdmVkU3RhdGUuZXhwYW5kZWRSb3dzW2tleXNbaV1dKSB7XG4gICAgICAgICAgbmV3UmVzb2x2ZWRTdGF0ZS5mcm96ZW4gPSB0cnVlXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIHRoZSBkYXRhIGlzbid0IGZyb3plbiBhbmQgZWl0aGVyIHRoZSBkYXRhIG9yXG4gICAgLy8gc29ydGluZyBtb2RlbCBoYXMgY2hhbmdlZCwgdXBkYXRlIHRoZSBkYXRhXG4gICAgaWYgKFxuICAgICAgKG9sZFN0YXRlLmZyb3plbiAmJiAhbmV3UmVzb2x2ZWRTdGF0ZS5mcm96ZW4pIHx8XG4gICAgICBvbGRTdGF0ZS5zb3J0aW5nICE9PSBuZXdSZXNvbHZlZFN0YXRlLnNvcnRpbmcgfHxcbiAgICAgICghbmV3UmVzb2x2ZWRTdGF0ZS5mcm96ZW4gJiYgb2xkU3RhdGUucmVzb2x2ZWREYXRhICE9PSBuZXdSZXNvbHZlZFN0YXRlLnJlc29sdmVkRGF0YSlcbiAgICApIHtcbiAgICAgIC8vIEhhbmRsZSBjb2xsYXBzZU9uU29ydGluZ0NoYW5nZSAmIGNvbGxhcHNlT25QYWdlQ2hhbmdlXG4gICAgICBpZiAoXG4gICAgICAgIChvbGRTdGF0ZS5zb3J0aW5nICE9PSBuZXdSZXNvbHZlZFN0YXRlLnNvcnRpbmcgJiYgdGhpcy5wcm9wcy5jb2xsYXBzZU9uU29ydGluZ0NoYW5nZSkgfHxcbiAgICAgICAgKCFuZXdSZXNvbHZlZFN0YXRlLmZyb3plbiAmJiBvbGRTdGF0ZS5yZXNvbHZlZERhdGEgIT09IG5ld1Jlc29sdmVkU3RhdGUucmVzb2x2ZWREYXRhICYmIHRoaXMucHJvcHMuY29sbGFwc2VPblBhZ2VDaGFuZ2UpXG4gICAgICApIHtcbiAgICAgICAgbmV3UmVzb2x2ZWRTdGF0ZS5leHBhbmRlZFJvd3MgPSB7fVxuICAgICAgfVxuXG4gICAgICBPYmplY3QuYXNzaWduKG5ld1Jlc29sdmVkU3RhdGUsIHRoaXMuZ2V0U29ydGVkRGF0YShuZXdSZXNvbHZlZFN0YXRlKSlcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgcGFnZVNpemUgYWxsIHRoZSB0aW1lXG4gICAgaWYgKG5ld1Jlc29sdmVkU3RhdGUucmVzb2x2ZWREYXRhKSB7XG4gICAgICBuZXdSZXNvbHZlZFN0YXRlLnBhZ2VzID0gbmV3UmVzb2x2ZWRTdGF0ZS5tYW51YWwgPyBuZXdSZXNvbHZlZFN0YXRlLnBhZ2VzIDogTWF0aC5jZWlsKG5ld1Jlc29sdmVkU3RhdGUucmVzb2x2ZWREYXRhLmxlbmd0aCAvIG5ld1Jlc29sdmVkU3RhdGUucGFnZVNpemUpXG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuc2V0U3RhdGUobmV3UmVzb2x2ZWRTdGF0ZSwgY2IpXG4gIH1cbn1cbiJdfQ==